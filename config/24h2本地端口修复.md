## 完整解决方案

根据诊断结果，问题是由于Windows 11 24H2的网络安全增强导致TCP连接状态异常。以下是完整的解决步骤：

### 1. 以管理员身份运行PowerShell，执行以下命令：

# 重置TCP/IP设置

netsh int tcp reset

netsh int ipv4 reset

netsh int ipv6 reset

netsh winsock reset

# 设置TCP参数优化本地连接

reg add "HKLM\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters" /v TcpTimedWaitDelay /t REG\_DWORD /d 30 /f

reg add "HKLM\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters" /v MaxUserPort /t REG\_DWORD /d 65534 /f

# 强制结束Sunshine进程

taskkill /im sunshine.exe /f

# 清理所有异常的TCP连接

netsh int tcp set global autotuninglevel\=normal

### 2. 添加防火墙规则（如果需要）：

# 为Sunshine添加防火墙规则

netsh advfirewall firewall add rule name\="Sunshine TCP 47990" dir\=in action\=allow protocol\=TCP localport\=47990

netsh advfirewall firewall add rule name\="Sunshine UDP 47990" dir\=in action\=allow protocol\=UDP localport\=47990

### 3. 禁用Windows 11 24H2的某些网络安全功能：

# 禁用网络DMA保护（可能影响本地连接）

reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceGuard" /v EnableVirtualizationBasedSecurity /t REG\_DWORD /d 0 /f

reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DeviceGuard" /v RequirePlatformSecurityFeatures /t REG\_DWORD /d 0 /f

### 4. 重启计算机使设置生效

### 5. 重新启动Sunshine应用

如果问题仍然存在，可能需要检查Sunshine的配置文件，或者考虑使用替代端口。